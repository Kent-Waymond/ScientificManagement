<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Payoffs</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="../assets/css/bootstrap-select.min.css">
    <script src="../jQuery/jquery-3.3.1.min%20(1).js"></script>
    <script type="text/javascript" src="../layui/layui.js"></script>
    <script type="text/javascript" src="../layui/layui.all.js"></script>
    <link rel="stylesheet" href="../layui/css/layui.css" type="text/css"/>
    <script src="https://vuejs.org/js/vue.js"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="../assets/js/bootstrap-select.js"></script>
    <style>
        *:not(input) {
            -webkit-user-select: none;
        }
    </style>
</head>
<body>
<div class="layui-col-md10 layui-col-md-offset2"  style="width: 1100px">
    <div class="layui-row grid-demo grid-demo-bg1">
        <div class="layui-col-md12" style="height: 100px;">
            <form class="layui-form" name="mainform" style="margin-top: 30px;">
                <div class="layui-form-item" >
                    <div class="layui-input-inline" style="margin-left: 0px;">
                        <select name="mainPerson" id="mainPerson" lay-filter="mainPerson"  lay-verify="required" lay-search="">
                        </select>
                    </div>

                    <div class="layui-input-inline" style="margin-left: 20px;">
                        <select name="mainTask" id="mainTask" lay-filter="mainTask" lay-verify="required" lay-search="">
                        </select>
                    </div>
                    <div class="layui-input-inline" style="margin-left: 20px;">
                        <select name="mainTaskType" id="mainTaskType" lay-filter="mainTaskType" lay-verify="required" lay-search="">
                        </select>
                    </div>
                    <div class="layui-input-inline" style="margin-left: 20px;">
                        <select name="mainStatus" id="mainStatus" lay-filter="mainStatus" lay-verify="required" lay-search="">
                        </select>
                    </div>
                    <div class=" layui-input-inline" style="margin-left: 15px;">
                        <button type="button" class="layui-btn layui-btn-normal" onclick="">查询</button>
                    </div>
                </div>
            </form>

            <div class="myThesis" style="display:block;">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 20px;">
                    <legend>论文</legend>
                </fieldset>
                <div class="layui-btn-group demoTable" id="myTToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addTContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addTDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" >项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectId" id="tprojectId" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">论文名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="thesisName" id="thesisName" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">论文类型</label>
                            <div class="layui-input-block">
                                <select name="typeCode" lay-verify="required" style="width: 350px">
                                    <option value="0">请选择类型</option>
                                    <option value="1601" >专题型</option>
                                    <option value="1602" >论辩型</option>
                                    <option value="1603" >综述型</option>
                                    <option value="1604" >综合型</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">期刊类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px"  name="periodicalType" id="periodicalType" required>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" >成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value= "0201" name="resultTypeId" id="tresultTypeId" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">期刊名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="periodicalName" id="periodicalName" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">发布日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="publishTime" id="tpublishTime" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="twid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者排名</label>
                            <div class="layui-input-block">
                                <select name="writerTypeId" id="torder" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一作者</option>
                                    <option value="1102" >第二作者</option>
                                    <option value="1103" >第三作者</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addTInfo();addTCode()">添加作者信息</button>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者信息</label>
                            <div class="layui-input-block" >
                                <textarea name="winfo" id="twinfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">码信息</label>
                            <div class="layui-input-block" >
                                <textarea name="detailInfo" id="tdetailInfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">确认添加</button>
                        </div>
                    </form>
                </div>
                <div id="uploadTContainer" style="display: none;width: 400px" >
                    <form class="layui-form" style="margin:30px" id="uploadTDetail" name="uploadTDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">文件名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 300px" name="fileName" id="tfileName" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">文件类型ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  value="1204" name="fileTypeId" id="tfileTypeId" required="required">
                            </div>
                        </div>
                    </form>
                    <div style="margin-left: 35px">
                        <button type="button" class="layui-btn layui-btn-normal" id="tchoosefile">选择文件</button>
                        <button type="button" class="layui-btn" id="tupload" >开始上传</button>
                    </div>
                </div>
                <div id="fileTContainer" style="display: none;width:480px" >
                    <table class="layui-table" id="myTtable" style="margin-left: 15px;">
                        <thead>
                        <tr >
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件名</th>
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件类型</th>
                        </tr>
                        </thead>
                        <tbody align="center" id="myTbody">
                        </tbody>
                    </table>
                </div>
                <table class="layui-table"  id='TTable' lay-filter="TTable" style="margin-top: -5px"></table>
            </div>
            <div class="mySoftwareWork" style="display:block;">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 30px;">
                    <legend>软著</legend>
                </fieldset>
                <div class="layui-btn-group demoTable" id="mySToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addSContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addSWDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" >项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectId" id="swprojectId" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">软著名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="softwareWorkName" id="swName" required>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" >成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value= "0202" name="resultTypeId " id="swresultTypeId " required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">发布日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="publishTime" id="swpublishTime" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="swwid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者排名</label>
                            <div class="layui-input-block">
                                <select name="writerTypeId" id="sworder" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一作者</option>
                                    <option value="1102" >第二作者</option>
                                    <option value="1103" >第三作者</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addSInfo();addSCode()">添加作者信息</button>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者信息</label>
                            <div class="layui-input-block" >
                                <textarea name="winfo" id="swwinfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">码信息</label>
                            <div class="layui-input-block" >
                                <textarea name="detailInfo" id="swdetailInfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">确认添加</button>
                        </div>
                    </form>
                </div>
                <div id="uploadSContainer" style="display: none;width: 400px" >
                    <form class="layui-form" style="margin:30px" id="uploadSDetail" name="uploadSDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">文件名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 300px" name="fileName" id="sfileName" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">文件类型ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  value="1205" name="fileTypeId" id="sfileTypeId" required="required">
                            </div>
                        </div>
                    </form>
                    <div style="margin-left: 35px">
                        <button type="button" class="layui-btn layui-btn-normal" id="schoosefile">选择文件</button>
                        <button type="button" class="layui-btn" id="supload" >开始上传</button>
                    </div>
                </div>
                <div id="fileSContainer" style="display: none;width:480px" >
                    <table class="layui-table" id="myStable" style="margin-left: 15px;">
                        <thead>
                        <tr >
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件名</th>
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件类型</th>
                        </tr>
                        </thead>
                        <tbody align="center" id="mySbody">
                        </tbody>
                    </table>
                </div>
                <table class="layui-table"  id='STable' lay-filter="STable" style="margin-top: -5px"></table>
            </div>
            <div class="myPatent" style="display:block;">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 30px;">
                    <legend>专利</legend>
                </fieldset>
                <!--表格-->
                <div class="layui-btn-group demoTable" id="myPToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addPContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addPDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label"  style="width: 100px">专利名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="patentName" id="patentName" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectId" id="pprojectId" required>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" >成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value= "0203" name="resultTypeId " id="pesultTypeId " required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" >性别</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="pgender" id="pgender">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">作者单位</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="punit" id="punit">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">作者职称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="pprofession" id="pprofession">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">专利状态</label>
                            <div class="layui-input-block">
                                <select name="patentStatus" lay-verify="required" style="width: 400px"  id="patentStatus">
                                    <option value="0">请选择专利状态</option>
                                    <option value="1401" >受理</option>
                                    <option value="1402" >授权</option>
                                    <option value="1403" >作废</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">文件类型</label>
                            <div class="layui-input-block">
                                <select name="ptype" lay-verify="required" style="width: 350px">
                                    <option value="0">请选择文件类型</option>
                                    <option value="1201" >交底说明书</option>
                                    <option value="1202" >受理通知书</option>
                                    <option value="1203" >设计文档</option>
                                    <option value="1204" >其他</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">成员情况</label>
                            <div class="layui-input-block">
                                <select name="ptypeID" lay-verify="required" style="width: 350px">
                                    <option value="0">请选择成员情况</option>
                                    <option value="1301" >团队内</option>
                                    <option value="1302" >团队外</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">代理公司</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="agencyCompany" id="agencyCompany">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">申请日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="applicationTime" id="applicationTime" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">受理日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="acceptanceTime" id="acceptanceTime" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">授权日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="authorizationTime" id="authorizationTime" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="pwid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 100px">作者排名</label>
                            <div class="layui-input-block">
                                <select name="writerTypeId" id="porder" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一作者</option>
                                    <option value="1102" >第二作者</option>
                                    <option value="1103" >第三作者</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addPInfo();addPCode()">添加作者信息</button>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者信息</label>
                            <div class="layui-input-block" >
                                <textarea name="winfo" id="pwinfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">码信息</label>
                            <div class="layui-input-block" >
                                <textarea name="detailInfo" id="pdetailInfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">确认添加</button>
                        </div>
                    </form>
                </div>
                <div id="uploadPContainer" style="display: none;width: 400px" >
                    <form class="layui-form" style="margin:30px" id="uploadPDetail" name="uploadPDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 105px">文件类型ID</label>
                            <div class="layui-input-block">
                                <select name="fileTypeId" lay-verify="required" style="width: 400px"  id="pfileTypeId">
                                    <option value="0">请选择文件类型</option>
                                    <option value="1201" >交底说明书</option>
                                    <option value="1202" >受理通知书</option>
                                    <option value="1203" >授权通知书</option>
                                </select>
                            </div>
                            <div class="layui-form-item" style="margin-top: 10px;">
                                <label class="layui-form-label" style="width: 90px">文件名称</label>
                                <div class="layui-input-block">
                                    <input class="layui-input" type="text"  style="width: 300px" name="fileName" id="pfileName" required="required">
                                </div>
                            </div>
                        </div>
                    </form>
                    <div style="margin-left: 35px">
                        <button type="button" class="layui-btn layui-btn-normal" id="pchoosefile">选择文件</button>
                        <button type="button" class="layui-btn" id="pupload" >开始上传</button>
                    </div>
                </div>
                <div id="filePContainer" style="display: none;width: 400px" >
                    <table class="layui-table" id="myPtable" style="margin-left: 55px;">
                        <thead>
                        <tr >
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件名</th>
                            <th style="text-align: center;" >操作</th>
                        </tr>
                        </thead>
                        <tbody align="center" id="myPbody">
                        </tbody>
                    </table>
                </div>

                <table class="layui-table"  id='PTable' lay-filter="PTable" style="margin-top: -5px"></table>
            </div>
            <div class="myWriting" style="display:block;">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 30px;">
                    <legend>书籍</legend>
                </fieldset>
                <div class="layui-btn-group demoTable" id="myWToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addWContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addWDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" >项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectId" id="wprojectId" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">书籍名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="writingsName" id="writingsName" required>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" >成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value= "0204" name="resultTypeId " id="wresultTypeId " required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">出版社</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="publishHouse" id="wpublishHouse" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">版本</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="version" id="wversion" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="wwid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者排名</label>
                            <div class="layui-input-block">
                                <select name="writerTypeId" id="worder" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一作者</option>
                                    <option value="1102" >第二作者</option>
                                    <option value="1103" >第三作者</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addWInfo();addWCode()">添加作者信息</button>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者信息</label>
                            <div class="layui-input-block" >
                                <textarea name="winfo" id="wwinfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">码信息</label>
                            <div class="layui-input-block" >
                                <textarea name="detailInfo" id="wdetailInfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">确认添加</button>
                        </div>
                    </form>
                </div>
                <table class="layui-table"  id='WTable' lay-filter="WTable" style="margin-top: -5px"></table>
            </div>
            <div class="myAward" style="display:block;">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 30px;">
                    <legend>奖项</legend>
                </fieldset>
                <div class="layui-btn-group demoTable" id="myAWToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addAWContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addAWDetail" name="addAWDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" >项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="PROJECT_ID" id="PROJECT_ID" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">奖项名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="AWARD_NAME" id="AWARD_NAME" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" >获奖颁发单位</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="AWARD_UNIT" id="AWARD_UNIT" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">获奖人姓名</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="NAME" id="NAME" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" >获奖人性别</label>
                            <div class="layui-input-block">
                                <select name="GENDER" id="GENDER" lay-verify="required" style="width: 350px">
                                    <option >请选择作性别</option>
                                    <option value="0101" >男</option>
                                    <option value="0102" >女</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">获奖人单位</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="UNIT" id="UNIT" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">获奖人职称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="PROFESSIONAL_TITLE" id="PROFESSIONAL_TITLE" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">获奖日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="AWARD_TIME" id="AWARD_TIME" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">名次</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="RANKING" id="RANKING" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label">成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value="0205" name="RESULT_TYPE_ID " id="RESULT_TYPE_ID " required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="awwid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" >获奖人排名</label>
                            <div class="layui-input-block">
                                <select name="WRITER_TYPE_ID" id="WRITER_TYPE_ID" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一获奖人</option>
                                    <option value="1102" >第二获奖人</option>
                                    <option value="1103" >第三获奖人</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">确认添加</button>
                        </div>
                    </form>
                </div>
                <div id="uploadAWContainer" style="display: none;width: 400px" >
                    <form class="layui-form" style="margin:30px" id="uploadAWDetail" name="uploadAWDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">文件名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 300px" name="fileName" id="awfileName" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">文件类型ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  value="1204" name="fileTypeId" id="awfileTypeId" required="required">
                            </div>
                        </div>
                    </form>
                    <div style="margin-left: 35px">
                        <button type="button" class="layui-btn layui-btn-normal" id="awchoosefile">选择文件</button>
                        <button type="button" class="layui-btn" id="awupload" >开始上传</button>
                    </div>
                </div>
                <div id="fileAWContainer" style="display: none;width:480px" >
                    <table class="layui-table" id="myAWtable" style="margin-left: 15px;">
                        <thead>
                        <tr >
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件名</th>
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件类型</th>
                        </tr>
                        </thead>
                        <tbody align="center" id="myAWbody">
                        </tbody>
                    </table>
                </div>
                <table class="layui-table"  id='AWTable' lay-filter="AWTable" style="margin-top: -5px"></table>

            </div>
            <div class="myApp" style="display: block">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 30px;">
                    <legend>软件</legend>
                </fieldset>
                <div class="layui-btn-group demoTable" id="myAToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addAContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addADetail" name="addADetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" >项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectId" id="projectId" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label"  style="width: 90px">软件名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="softwareName" id="softwareName" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">发布日期</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="publishTime" id="publishTime"  required="required" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label">成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value="0206" name="resultTypeId" id="aresultTypeId " required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" >网址</label>
                            <div class="layui-input-block">

                                <input class="layui-input" type="text"  style="width: 350px" name="webSite" id="webSite" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="awid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者排名</label>
                            <div class="layui-input-block">
                                <select name="writerTypeId" id="aorder" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一作者</option>
                                    <option value="1102" >第二作者</option>
                                    <option value="1103" >第三作者</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addInfo();addCode()">添加作者信息</button>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者信息</label>
                            <div class="layui-input-block" >
                                <textarea name="winfo" id="awinfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">码信息</label>
                            <div class="layui-input-block" >
                                <textarea name="detailInfo" id="detailInfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">提交</button>
                        </div>
                    </form>
                </div>
                <div id="uploadAContainer" style="display: none;width: 400px" >
                    <form class="layui-form" style="margin:30px" id="uploadADetail" name="uploadADetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">文件名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 300px" name="fileName" id="afileName" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">文件类型ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  value="1205" name="fileTypeId" id="afileTypeId" required="required">
                            </div>
                        </div>
                    </form>
                    <div style="margin-left: 35px">
                        <button type="button" class="layui-btn layui-btn-normal" id="achoosefile">选择文件</button>
                        <button type="button" class="layui-btn" id="aupload" >开始上传</button>
                    </div>
                </div>
                <div id="fileAContainer" style="display: none;width:480px" >
                    <table class="layui-table" id="myAtable" style="margin-left: 15px;">
                        <thead>
                        <tr >
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件名</th>
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件类型</th>
                        </tr>
                        </thead>
                        <tbody align="center" id="myAbody">
                        </tbody>
                    </table>
                </div>
                <table class="layui-table"  id='ATable' lay-filter="ATable" style="margin-top: -5px"></table>
            </div>
            <div class="myReport" style="display:block;">
                <fieldset class="layui-elem-field layui-field-title site-demo-button" style="margin-top: 30px;">
                    <legend>报告</legend>
                </fieldset>
                <div class="layui-btn-group demoTable" id="myRToolbar" style="display: none">
                    <button class="layui-btn layui-btn-normal layui-btn-sm " lay-event="add">添加</button>
                    <button class="layui-btn layui-btn-sm layui-btn-danger" lay-event="delete">批量删除</button>
                </div>
                <div id="addRContainer" style="display: none;width: 500px" >
                    <form class="layui-form" style="margin:30px" id="addRDetail">
                        <div class="layui-form-item" >
                            <label class="layui-form-label" style="width: 90px">项目ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectId" id="rprojectId" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">报告名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="projectResultName" id="projectResultName" required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">撰写时间</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" name="writeTime" id="writeTime"  required="required" onfocus="(this.type='date')" onblur="(this.type='text')">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label">成果类型</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 350px" value="0207" name="resultTypeId" id="rresultTypeId " required>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label">作者</label>
                            <div class="layui-input-block">
                                <select name="wid" id="rwid" lay-verify="required" style="width: 350px" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者排名</label>
                            <div class="layui-input-block">
                                <select name="writerTypeId" id="rorder" lay-verify="required" style="width: 350px">
                                    <option >请选择作者排名</option>
                                    <option value="1101" >第一作者</option>
                                    <option value="1102" >第二作者</option>
                                    <option value="1103" >第三作者</option>
                                </select>
                            </div>
                        </div>
                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addRInfo();addRCode()">添加作者信息</button>
                        </div>
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">作者信息</label>
                            <div class="layui-input-block" >
                                <textarea name="rwinfo" id="rwinfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">码信息</label>
                            <div class="layui-input-block" >
                                <textarea name="rdetailInfo" id="rdetailInfo" lay-verify="required" style="width: 350px" ></textarea>
                            </div>
                        </div>

                        <div class="layui-form-item" align="center">
                            <button type="button" class="layui-btn layui-btn-radius layui-btn-normal" onclick="addDetail()">确认添加</button>
                        </div>
                    </form>
                </div>
                <div id="uploadRContainer" style="display: none;width: 400px" >
                    <form class="layui-form" style="margin:30px" id="uploadRDetail" name="uploadRDetail">
                        <div class="layui-form-item">
                            <label class="layui-form-label" style="width: 90px">文件名称</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  style="width: 300px" name="fileName" id="rfileName" required="required">
                            </div>
                        </div>
                        <div class="layui-form-item" style="display: none">
                            <label class="layui-form-label" style="width: 90px">文件类型ID</label>
                            <div class="layui-input-block">
                                <input class="layui-input" type="text"  value="1204" name="fileTypeId" id="rfileTypeId" required="required">
                            </div>
                        </div>
                    </form>
                    <div style="margin-left: 35px">
                        <button type="button" class="layui-btn layui-btn-normal" id="rchoosefile">选择文件</button>
                        <button type="button" class="layui-btn" id="rupload" >开始上传</button>
                    </div>
                </div>
                <div id="fileRContainer" style="display: none;width:480px" >
                    <table class="layui-table" id="myRtable" style="margin-left: 15px;">
                        <thead>
                        <tr >
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件名</th>
                            <th lay-data="{field:'stock',sort: true}" style="text-align: center;">文件类型</th>
                        </tr>
                        </thead>
                        <tbody align="center" id="myRbody">
                        </tbody>
                    </table>
                </div>
                <table class="layui-table"  id='RTable' lay-filter="RTable" style="margin-top: -5px"></table>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="handle">
    <a class="layui-btn layui-btn-xs layui-btn-blue" lay-event="upload" id="upload">上传</a>
    <a class="layui-btn layui-btn-xs layui-bg-orange" lay-event="download" id="download">下载</a>
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="del" id="del">删除</a>
</script>

<script type="text/html" id="file">
    <a class="layui-btn layui-btn-xs layui-btn-blue" lay-event="filework" id="filework">相关文件</a>
</script>

<script type="text/html" id="handleDel">
    <a class="layui-btn layui-btn-xs layui-btn-danger" lay-event="dele" id="dele">删除</a>
</script>

<!--mainform-->
<script>
    var http = "http://148.70.243.66:8888";

    layui.use('form', function(){//需要渲染form才能在界面显示
        var form = layui.form;
        form.render();
    });
    //作者信息生成
    function generateWriter() {
        $.get(http+"/api/authorManager/findAuthor",function (result) {
            var idstr = ''
            idstr += ' <option value="">'+"请选择作者"+'</option>';
            for (var i=0;i<result.data.length;i++){
                var ops = ' <option value='+result.data[i].wid+'>'+ result.data[i].name +'</option>'
                idstr += ops
            }
       /*     console.log(idstr)*/
            $("#awid").html(idstr)//软件
            $("#rwid").html(idstr)//报告
            $("#twid").html(idstr)//论文
            $("#swwid").html(idstr)//软著
            $("#pwid").html(idstr)//专利
            $("#wwid").html(idstr)//著作
        })
    }
    generateWriter()

    //如果是管理员则生成，否则disabled
    layui.use('form', function(){//需要渲染form才能在界面显示
        var form = layui.form;
        $.post(http+"/api/manager/queryAllUser",function (result) {
            var userstr = ''
            userstr += ' <option value="">'+"请选择姓名"+'</option> ';
            for (var i=0;i<result.data.length;i++){
                var ops = '<option value='+result.data[i].user_role.uid+'>'+ result.data[i].user_role.username +'</option> '
                userstr += ops
            }
       /*     console.log(userstr)*/
            $("#mainPerson").html(userstr)//姓名
            form.render('select');
        })

        form.on('select(mainPerson)', function (data) {
            $.get(http+"/api/project/findProjectInfo",{userId:data.value},function (result) {
                var taskstr = ''
                taskstr += ' <option value="">'+"请选择项目"+'</option>';
                for (var i=0;i<result.data.length;i++){
                    var ops = ' <option value='+result.data[i].pid+'>'+ result.data[i].pname +'</option>'
                    taskstr += ops
                }
                /*console.log(taskstr)*/
                $("#mainTask").html(taskstr)//项目
                form.render('select');
            })
        });
        $.post(http+"/api/DetailType/findByBID",{bid:"03"},function (result) {
            var typestr = ''
            for (var i=0;i<result.data.length;i++){
                var ops = '<option value='+result.data[i].did+'>'+ result.data[i].dname +'</option> '
                typestr += ops
            }
            $("#mainTaskType").html(typestr)//项目类型
            $("select[name='mainTaskType']").find("option[value='"+result.data[1].did+"']").attr("selected",true);
            form.render('select');
        })

        $.post(http+"/api/DetailType/findByBID",{bid:"06"},function (result) {
            var typestr = ''
            var ops = '<option value='+result.data[0].did+'>'+ result.data[0].dname +'</option> '
            typestr += ops
            var opt = '<option value='+result.data[1].did+' selected='+`"selected"`+'>'+ result.data[1].dname +'</option> '
            // console.log(opt);
            typestr += opt
            $("#mainStatus").html(typestr)//状态
            form.render('select');
        })
    });

   /* function uploadFile(container,detail,uploadbtn,choosebtn,uuid) {
        uploadlay = layer.open({
            type: 1,
            title: '上传文件',
            area: ['40%', '40%'],
            content: $('#'+container),
            end: function () {

            }
        });
        //文件上传
        $("#"+uploadbtn).on('click',function () {
            file.config.data = {
                uuid:uuid,
                fileName:detail.fileName.value,
                fileTypeId:detail.fileTypeId.value
            }
            console.log(data)
            console.log("11111111111111111111111111111111")
            console.log(data.uuid)
            console.log(uploadADetail.fileName.value)
            console.log(uploadADetail.fileTypeId.value)
        })

        var upload = layui.upload,
            element = layui.element;
        element.init();

        file = upload.render({
            elem: '#'+choosebtn
            ,url: http + "/api/resultFile/uploadFile"
            ,accept: 'file' //允许上传的文件类型
            ,auto: false
            ,bindAction: '#'+uploadbtn
            ,done: function(res){
                layui.use('layer', function(){
                    var layer = layui.layer;
                    layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                    setTimeout(function(){
                        //刷新
                        location.reload();
                    },1000);
                });
                console.log(res)  //返回对象数据
            }
        })
    }*/

</script>

<!--论文-->
<script>
    var addlay,uploadlay,filelay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#TTable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'thesisName', title: '论文名称', align: 'center'},
                    {field: 'projectName', title: '项目名称', align: 'center'},
                    {field: 'periodicalName', title: '期刊名称', align: 'center'},
                    {field: 'periodicalType', title: '期刊类型', align: 'center'},
                    {field: 'publishedTime', title: '发表时间', align: 'center'},
                    {field: 'writers', title: '作者', align: 'center'},
                    {fixed: 'right', title: '文件', templet: '#file', align: 'center'},
                    {fixed: 'right', title: '操作', templet: '#handle', align: 'center'}
                ]],
                page: true,
                toolbar: '#myTToolbar',

            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/resultThesis/find',function (result) {
              /*  console.log(result.data)*/
                for(var i=0;i<result.data.length;i++){
                    console.log(result.data.length)
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writers.length;j++){
                        console.log(result.data[i].writers.length)
                        authorinfo += result.data[i].writers[j].writerName + ":" + result.data[i].writers[j].gender +","+ result.data[i].writers[j].unit +","+ result.data[i].writers[j].professionalTitle +","+ result.data[i].writers[j].typeName +","+ result.data[i].writers[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writers = authorinfo
                }
   /*             console.log(authorinfo)*/
                loadData(result.data);
            });
        }
        loadTable()

        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addTContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(TTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加软件信息',
                        area: ['50%', '70%'],
                        content: $('#addTContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                        layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                            $.get(http+'/api/resultThesis/delete', {"uuid": dids}, function () {
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                    loadTable()
                                });
                            });
                            layer.close(index);
                        });
                    }
                    break;
            }
        });
        //单个删除/下载/上传
        table.on('tool(TTable)', function(obj) {
            var data = obj.data;
            console.log(data)
            if(obj.event === 'filework'){
                filelay = layer.open({
                    type: 1,
                    title: '相关文件',
                    area: ['40%', '60%'],
                    content: $('#fileTContainer'),
                });
                console.log(data.uuid)
                $.get(http+"/api/resultFile/findFiles",{resultId:data.uuid},function(result) {
                    console.log(result)
                    var str = ''
                    console.log(result.data.length)
                    for (var i=0;i<result.data.length;i++){
                        str += '<tr>';
                        var tds =  '<td>' + result.data[i].fileName + '</td>'
                            + '<td>' + result.data[i].fileType + '</td>';
                        str += tds ;
                        str += '</tr>';
                    }
                    $("#myTbody").html(str)
                });
            }
            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    obj.del();
                    $.get(http+'/api/resultThesis/delete', {"uuid": data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }
            if (obj.event === 'upload') {
                uploadlay = layer.open({
                    type: 1,
                    title: '上传软件文件',
                    area: ['40%', '40%'],
                    content: $('#uploadTContainer'),
                    end: function () {

                    }
                });
                //文件上传
                $("#tupload").on('click',function () {
                    file.config.data = {
                        uuid:data.uuid,
                        fileName:uploadTDetail.fileName.value,
                        fileTypeId:uploadTDetail.fileTypeId.value
                    }
                })

                var upload = layui.upload,
                    element = layui.element;
                element.init();

                file = upload.render({
                    elem: '#tchoosefile'
                    ,url: http + "/api/resultFile/uploadFile"
                    ,accept: 'file' //允许上传的文件类型
                    ,auto: false
                    //,multiple: true
                    ,bindAction: '#tupload'
                    ,done: function(res){
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                        console.log(res)  //返回对象数据
                    }
                })
            }
            if(obj.event === 'download'){
                layer.confirm('请选择下载文件！', {
                    title: "Tips" ,btnAlign: 'c',
                    btn: ['设计文档下载', '相关文件下载','取消']
                    ,btn3: function(index, layero){
                        layer.close()
                    }
                }, function(index, layero){
                    $.get(http+'/api/software/downLoadFile', {fileId:data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                }, function(index){
                    //按钮二的回调
                    $.get(http+'/api/software/downLoadFile', {fileId:data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                });
            }
        });
    });
    //添加作者信息
    function addTInfo() {
        var winfo = []
        winfo =  $("#twid").find("option:selected").text() + ":" +  $("#torder").find("option:selected").text()
        $("#twinfo").append(winfo+",")
    }
    //添加码信息
    function addTCode() {
        var dinfo = []
        dinfo =  $("#twid").find("option:selected").val() + "," +  $("#torder").find("option:selected").val() + ","
        $("#tdetailInfo").append(dinfo)
    }

    //转格式
    $.fn.serializeObject = function()
    {
        var res = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (res[this.name] !== undefined) {
                if (!res[this.name].push) {
                    res[this.name] = [res[this.name]];
                }
                res[this.name].push(this.value || '');
            } else {
                res[this.name] = this.value || '';
            }
        });
        return res;
    };
    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        function form2JsonString(formId) {
            var paramArray = $('#' + formId).serializeArray();
            var jsonObj = {};
            $(paramArray).each(function () {
                jsonObj[this.name] = this.value;
            });
            return JSON.stringify(jsonObj);
        }
        swjsondata  = eval("("+form2JsonString("addTDetail")+")");
        console.log(swjsondata)
        console.log("1111111111111111111111111")
        var writer = swjsondata.detailInfo.split(",")
        console.log(writer)
        var writers = [];

        for(var i=0;i<(writer.length-1)/2;i++){
            var order ={
                "resultTypeId": swjsondata.resultTypeId,
                "writerId": writer[2*i],
                "writerTypeId": writer[2*i+1]
            }
            console.log(order)
            writers.push(order)
        }
        console.log(writers)
        var a = {
            "periodicalName": swjsondata.periodicalName,
            "periodicalType": swjsondata.periodicalType,
            "projectId": swjsondata.projectId,
            "publishTime": swjsondata.publishTime,
            "thesisName": swjsondata.thesisName,
            "typeCode": swjsondata.typeCode,
            writers: writers
        };
        console.log(a)
        $.ajax({
            type:"post",
            url:http+"/api/resultThesis/insert",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:JSON.stringify(a),
            success: function (data) {
                layer.msg('添加成功'+data.status);
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>

<!--软著-->
<script>
    var addlay,uploadlay,filelay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#STable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'softwareWorkName', title: '软著名称', align: 'center'},
                    {field: 'projectName', title: '项目名称', align: 'center'},
                    {field: 'authorizationNum', title: '授权号', align: 'center'},
                    {field: 'authorizationTime', title: '授权日期', sort: true, align: 'center'},
                    {field: 'applicationNum', title: '申请号', align: 'center'},
                    {field: 'writers', title: '作者', align: 'center'},
                    {fixed: 'right', title: '文件', templet: '#file', align: 'center'},
                    {fixed: 'right', title: '操作', templet: '#handle', align: 'center'}
                ]],
                page: true,
                toolbar: '#mySToolbar',

            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/resultSoftwareWork/find',function (result) {
                for(var i=0;i<result.data.length;i++){
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writers.length;j++){
                        authorinfo += result.data[i].writers[j].writerName + ":" + result.data[i].writers[j].gender +","+ result.data[i].writers[j].unit +","+ result.data[i].writers[j].typeName +","+ result.data[i].writers[j].professionalTitle +","+ result.data[i].writers[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writers = authorinfo
                }
                loadData(result.data);
            });
        }
        loadTable()

        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addSContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(STable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加软著信息',
                        area: ['80%', '70%'],
                        content: $('#addSContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                        layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                            $.get(http+'/api/resultSoftwareWork/delete', {"uuid": dids}, function () {
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                    loadTable()
                                });
                            });
                            layer.close(index);
                        });
                    }
                    break;
            }
        });
        //单个删除/下载
        table.on('tool(STable)', function(obj) {
            var data = obj.data;
            console.log(data)
            if(obj.event === 'filework'){
                filelay = layer.open({
                    type: 1,
                    title: '相关文件',
                    area: ['40%', '60%'],
                    content: $('#fileSContainer'),
                });
                console.log(data.uuid)
                $.get(http+"/api/resultFile/findFiles",{resultId:data.uuid},function(result) {
                    console.log(result)
                    var str = ''
                    console.log(result.data.length)
                    for (var i=0;i<result.data.length;i++){
                        str += '<tr>';
                        var tds =  '<td>' + result.data[i].fileName + '</td>'
                            + '<td>' + result.data[i].fileType + '</td>';
                        str += tds ;
                        str += '</tr>';
                    }
                    $("#mySbody").html(str)
                });
            }
            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    obj.del();
                    $.get(http+'/api/resultSoftwareWork/delete', {uuid: data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }
            if (obj.event === 'upload') {
                uploadlay = layer.open({
                    type: 1,
                    title: '上传软著文件',
                    area: ['40%', '40%'],
                    content: $('#uploadSContainer'),
                    end: function () {

                    }
                });
                //文件上传
                $("#supload").on('click',function () {
                    file.config.data = {
                        uuid:data.uuid,
                        fileName:uploadSDetail.fileName.value,
                        fileTypeId:uploadSDetail.fileTypeId.value
                    }
                })

                var upload = layui.upload,
                    element = layui.element;
                element.init();

                file = upload.render({
                    elem: '#schoosefile'
                    ,url: http + "/api/resultFile/uploadFile"
                    ,accept: 'file' //允许上传的文件类型
                    ,auto: false
                    //,multiple: true
                    ,bindAction: '#supload'
                    ,done: function(res){
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                        console.log(res)  //返回对象数据
                    }
                })
            }
            if(obj.event === 'download'){
                layer.confirm('是否下载?', {
                    title: "Tips" ,btnAlign: 'c',
                    btn: ['扫描件下载','取消']
                    ,btn2: function(index, layero){
                        layer.close()
                    }
                }, function(index, layero){
                    $.get(http+'/api/software/downLoadFile', {fileId:data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                });
            }
        });
    });
    //添加作者信息
    function addSInfo() {
        var winfo = []
        winfo =  $("#swwid").find("option:selected").text() + ":" +  $("#sworder").find("option:selected").text()
        $("#swwinfo").append(winfo+",")
    }
    //添加码信息
    function addSCode() {
        var dinfo = []
        dinfo =  $("#swwid").find("option:selected").val() + "," +  $("#sworder").find("option:selected").val() + ","
        $("#swdetailInfo").append(dinfo)
    }

    //转格式
    $.fn.serializeObject = function()
    {
        var res = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (res[this.name] !== undefined) {
                if (!res[this.name].push) {
                    res[this.name] = [res[this.name]];
                }
                res[this.name].push(this.value || '');
            } else {
                res[this.name] = this.value || '';
            }
        });
        return res;
    };
    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        function form2JsonString(formId) {
            var paramArray = $('#' + formId).serializeArray();
            var jsonObj = {};
            $(paramArray).each(function () {
                jsonObj[this.name] = this.value;
            });
            return JSON.stringify(jsonObj);
        }
        var swjsondata  = eval("("+form2JsonString("addSWDetail")+")");
        console.log(swjsondata)
        console.log("1111111111111111111111111")
        var writer = swjsondata.detailInfo.split(",")
        console.log(writer)
        var writers = [];

        for(var i=0;i<(writer.length-1)/2;i++){
            var order ={
                "resultTypeId": swjsondata.resultTypeId,
                "writerId": writer[2*i],
                "writerTypeId": writer[2*i+1]
            }
            console.log(order)
            writers.push(order)
        }
        console.log(writers)
        var a = {
            "applicationNum": swjsondata.applicationNum,
            "authorizationNum": swjsondata.authorizationNum,
            "authorizationTime": swjsondata.authorizationTime,
            "projectId": swjsondata.projectId,
            "softwareWorkName": swjsondata.softwareWorkName,
            writers: writers
        };
        console.log(a)
        $.ajax({
            type:"post",
            url:http+"/api/resultSoftwareWork/insert",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:JSON.stringify(a),
            success: function (data) {
                layer.msg('添加成功'+data.status);
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>

<!--专利-->
<script>
    var addlay,uploadlay,filelay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#PTable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'patentName', title: '专利名称', align: 'center'},
                    {field: 'projectName', title: '项目名称', align: 'center'},
                    {field: 'writers', title: '作者', align: 'center'},
                    {field: 'applicationTime', title: '申请日期', sort: true, align: 'center'},
                    {field: 'acceptanceTime', title: '受理日期', sort: true, align: 'center'},
                    {field: 'authorizationTime', title: '授权日期', sort: true, align: 'center'},
                    {field: 'patentStatus', title: '状态', align: 'center'},
                    {field: 'agencyCompany', title: '代理公司', align: 'center'},
                    {fixed: 'right', title: '文件', templet: '#file', align: 'center'},
                    {fixed: 'right', title: '操作', templet: '#handle', align: 'center'}
                ]],
                toolbar: '#myPToolbar',

            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/resultPatent/find',function (result) {
                for(var i=0;i<result.data.length;i++){
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writers.length;j++){
                        authorinfo += result.data[i].writers[j].writerName + ":" + result.data[i].writers[j].gender +","+ result.data[i].writers[j].unit +","+ result.data[i].writers[j].typeName +","+ result.data[i].writers[j].professionalTitle +","+ result.data[i].writers[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writers = authorinfo //修改作者信息格式
                    console.log(authorinfo)
                }
                loadData(result.data);
            });
        }
        loadTable()

        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addPContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(PTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加专利信息',
                        area: ['80%', '70%'],
                        content: $('#addPContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                       layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                            $.get(http+'/api/resultPatent/delete', {"uuid": dids}, function () {
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                    loadTable()
                                });
                            });
                            layer.close(index);
                        });
                    }
                    break;
            }
        });
        //单个删除/下载
        table.on('tool(PTable)', function(obj) {
            var data = obj.data;
            console.log(data.uuid)
            if(obj.event === 'filework'){
                filelay = layer.open({
                    type: 1,
                    title: '相关文件',
                    area: ['40%', '60%'],
                    content: $('#filePContainer'),
                });
                console.log(data.uuid)
                $.get(http+"/api/resultFile/findFiles",{resultId:data.uuid},function(result) {
                    console.log(result)
                    var str = ''
                    console.log(result.data.length)
                    for (var i=0;i<result.data.length;i++){
                        str += '<tr>';
                        var tds =  '<td>' + result.data[i].fileName + '</td>'
                            + '<td>' + result.data[i].fileType + '</td>';
                        str += tds ;
                        str += '</tr>';
                    }
                    $("#myPbody").html(str)
                });
            }
/*            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    obj.del();
                    $.get(http+'/api/resultPatent/delete', {uuid:data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }
            if (obj.event === 'upload') {
            var res = obj.data;
                uploadlay = layer.open({
                    type: 1,
                    title: '上传专利文件',
                    area: ['40%', '40%'],
                    content: $('#uploadPContainer'),
                    end: function () {

                    }
                });
                //文件上传
                $("#pupload").on('click',function () {
                    file.config.data = {
                        uuid:res.uuid,
                        fileName:uploadPDetail.fileName.value,
                        fileTypeId:uploadPDetail.fileTypeId.value
                    }
                    console.log(res.uuid)
                    console.log(uploadPDetail.fileName.value)
                    console.log(uploadPDetail.fileTypeId.value)
                })

                var upload = layui.upload,
                    element = layui.element;
                element.init();

                file = upload.render({
                    elem: '#pchoosefile'
                    ,url: http + "/api/resultFile/uploadFile"
                    ,accept: 'file' //允许上传的文件类型
                    ,auto: false
                    //,multiple: true
                    ,bindAction: '#pupload'
                    ,done: function(res){
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                        console.log(res)  //返回对象数据
                    }
                })
            }
            if(obj.event === 'download'){
                layer.confirm('请选择下载文件！', {
                    title: "Tips" ,
                    btnAlign: 'c',
                    btn: ['交底说明书下载', '受理通知书下载','授权通知书下载','取消']
                    ,btn4: function(index, layero){
                        layer.close()
                    }
                }, function(index, layero){
                    $.get(http+'/api/software/downLoadFile', {fileId: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                }, function(index){
                    //按钮二的回调
                    $.get(http+'/api/software/downLoadFile', {fileId: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                },function(index){
                        //按钮三的回调
                        $.get(http+'/api/software/downLoadFile', {fileId: data.uuid}, function (result) {
                            if(result.status =="success"){
                                var layer = layui.layer;
                                layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                            }
                        })
                    });
            }*/
        });
    });
    //添加作者信息
    function addPInfo() {
        var winfo = []
        winfo =  $("#pwid").find("option:selected").text() + ":" +  $("#porder").find("option:selected").text()
        $("#pwinfo").append(winfo+",")
    }
    //添加码信息
    function addPCode() {
        var dinfo = []
        dinfo =  $("#pwid").find("option:selected").val() + "," +  $("#porder").find("option:selected").val() + ","
        $("#pdetailInfo").append(dinfo)
    }

    //转格式
    $.fn.serializeObject = function()
    {
        var res = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (res[this.name] !== undefined) {
                if (!res[this.name].push) {
                    res[this.name] = [res[this.name]];
                }
                res[this.name].push(this.value || '');
            } else {
                res[this.name] = this.value || '';
            }
        });
        return res;
    };
    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        function form2JsonString(formId) {
            var paramArray = $('#' + formId).serializeArray();
            var jsonObj = {};
            $(paramArray).each(function () {
                jsonObj[this.name] = this.value;
            });
            return JSON.stringify(jsonObj);
        }
        var pjsondata  = eval("("+form2JsonString("addPDetail")+")");
        console.log(pjsondata)
        console.log("1111111111111111111111111")
        var writer = pjsondata.detailInfo.split(",")
        console.log(writer)
        var writers = [];

        for(var i=0;i<(writer.length-1)/2;i++){
            var order ={
                "resultTypeId": pjsondata.resultTypeId,
                "writerId": writer[2*i],
                "writerTypeId": writer[2*i+1]
            }
            console.log(order)
            writers.push(order)
        }
        console.log(writers)
        var a = {
            "acceptanceTime": pjsondata.acceptanceTime,
            "agencyCompany": pjsondata.agencyCompany,
            "applicationTime": pjsondata.applicationTime,
            "authorizationTime": pjsondata.authorizationTime,
            "patentName": pjsondata.patentName,
            "patentStatus": pjsondata.patentStatus,
            "projectId": pjsondata.projectId,
            writers: writers
        };
        console.log(a)
        $.ajax({
            type:"post",
            url:http+"/api/resultPatent/insert",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:JSON.stringify(a),
            success: function (data) {
                layer.msg('添加成功');
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>

<!--著作-->
<script>
    var addlay,editlay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#WTable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'writingsName', title: '书籍名称'},
                    {field: 'projectName', title: '项目名称'},
                    {field: 'writers', title: '作者'},
                    {field: 'writingsType', title: '类型'},
                    {field: 'publishHouse', title: '出版社'},
                    {field: 'version', title: '版本'},
                    {fixed: 'right', title: '操作', templet: '#handleDel', align: 'center'}
                ]],
                page: true,
                toolbar: '#myWToolbar',

            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/resultBook/find',function (result) {
                for(var i=0;i<result.data.length;i++){
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writers.length;j++){
                        authorinfo += result.data[i].writers[j].writerName + ":" + result.data[i].writers[j].gender +","+ result.data[i].writers[j].unit +","+ result.data[i].writers[j].typeName +","+ result.data[i].writers[j].professionalTitle +","+ result.data[i].writers[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writers = authorinfo
                }
                loadData(result.data);
            });
        }
        loadTable()

        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addWContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(WTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加软件信息',
                        area: ['50%', '70%'],
                        content: $('#addWContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                        $.get(http+'/api/resultBook/delete',{"uuid":dids},function () {
                            layui.use('layer', function(){
                                var layer = layui.layer;
                                layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                loadTable();
                            });
                        })
                    }
                    break;
            }
        });
        //单个删除/下载
        table.on('tool(WTable)', function(obj) {
            var data = obj.data;
            console.log(data)
            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    obj.del();
                    $.get(http+'/api/resultBook/delete', {"uuid": data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }
        });
    });
    //添加作者信息
    function addWInfo() {
        var winfo = []
        winfo =  $("#wwid").find("option:selected").text() + ":" +  $("#worder").find("option:selected").text()
        $("#wwinfo").append(winfo+",")
    }
    //添加码信息
    function addWCode() {
        var dinfo = []
        dinfo =  $("#wwid").find("option:selected").val() + "," +  $("#worder").find("option:selected").val() + ","
        $("#wdetailInfo").append(dinfo)
    }

    //转格式
    $.fn.serializeObject = function()
    {
        var res = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (res[this.name] !== undefined) {
                if (!res[this.name].push) {
                    res[this.name] = [res[this.name]];
                }
                res[this.name].push(this.value || '');
            } else {
                res[this.name] = this.value || '';
            }
        });
        return res;
    };
    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        function form2JsonString(formId) {
            var paramArray = $('#' + formId).serializeArray();
            var jsonObj = {};
            $(paramArray).each(function () {
                jsonObj[this.name] = this.value;
            });
            return JSON.stringify(jsonObj);
        }
        var wjsondata  = eval("("+form2JsonString("addWDetail")+")");
        console.log(wjsondata)
        console.log("1111111111111111111111111")
        var writer = wjsondata.detailInfo.split(",")
        console.log(writer)
        var writers = [];

        for(var i=0;i<(writer.length-1)/2;i++){
            var order ={
                "resultTypeId": wjsondata.resultTypeId,
                "writerId": writer[2*i],
                "writerTypeId": writer[2*i+1]
            }
            console.log(order)
            writers.push(order)
        }
        console.log(writers)
        var a = {
            "projectId": wjsondata.projectId,
            "publishHouse": wjsondata.publishHouse,
            "version": wjsondata.version,
            writers: writers,
            "writingsName": wjsondata.writingsName,
            "writingsType": wjsondata.writingsType
        };
        console.log(a)
        $.ajax({
            type:"post",
            url:http+"/api/resultBook/insert",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:JSON.stringify(a),
            success: function (data) {
                layer.msg('添加成功!');
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>

<!--获奖-->
<script>
    var addlay,uploadlay,filelay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#AWTable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'writingsName', title: '书籍名称'},
                    {field: 'projectName', title: '项目名称'},
                    {field: 'writers', title: '作者'},
                    {field: 'writingsType', title: '类型'},
                    {field: 'publishHouse', title: '出版社'},
                    {field: 'version', title: '版本'},
                    {fixed: 'right', title: '文件', templet: '#file', align: 'center'},
                    {fixed: 'right', title: '操作', templet: '#handle', align: 'center'}
                ]],
                page: true,
                toolbar: '#myAWToolbar',

            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/resultBook/find',function (result) {
                for(var i=0;i<result.data.length;i++){
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writers.length;j++){
                        authorinfo += result.data[i].writers[j].writerName + ":" + result.data[i].writers[j].gender +","+ result.data[i].writers[j].unit +","+ result.data[i].writers[j].typeName +","+ result.data[i].writers[j].professionalTitle +","+ result.data[i].writers[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writers = authorinfo
                }
                loadData(result.data);
            });
        }
        loadTable()


        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addAWContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(AWTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加软件信息',
                        area: ['50%', '70%'],
                        content: $('#addAWContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                        layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                            $.get(http+'/api/resultAward/delete', {"uuid": dids}, function () {
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                    loadTable()
                                });
                            });
                            layer.close(index);
                        });
                    }
                    break;
            }
        });
        //单个删除/下载
        table.on('tool(AWTable)', function(obj) {
            var data = obj.data;
            console.log(data)
            if(obj.event === 'filework'){
                filelay = layer.open({
                    type: 1,
                    title: '相关文件',
                    area: ['40%', '60%'],
                    content: $('#fileAWContainer'),
                });
                console.log(data.uuid)
                $.get(http+"/api/resultFile/findFiles",{resultId:data.uuid},function(result) {
                    console.log(result)
                    var str = ''
                    console.log(result.data.length)
                    for (var i=0;i<result.data.length;i++){
                        str += '<tr>';
                        var tds =  '<td>' + result.data[i].fileName + '</td>'
                            + '<td>' + result.data[i].fileType + '</td>';
                        str += tds ;
                        str += '</tr>';
                    }
                    $("#myAWbody").html(str)
                });
            }
            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    obj.del();
                    $.get(http+'/api/resultAward/delete', {"uuid": data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }
            if(obj.event === 'download'){
                layer.confirm('是否下载?', {
                    title: "Tips" ,btnAlign: 'c',
                    btn: [ '获奖扫描件下载','取消']
                    ,btn2: function(index, layero){
                        layer.close()
                    }
                }, function(index, layero){
                    $.get(http+'/api/resultFile/downLoadFile', {fileId: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                });
            }
            if (obj.event === 'upload') {
                uploadlay = layer.open({
                    type: 1,
                    title: '上传获奖扫描件',
                    area: ['40%', '40%'],
                    content: $('#uploadAWContainer'),
                    /*end: function () {
                    }*/
                });
                //文件上传
                $("#awupload").on('click',function () {
                    file.config.data = {
                        uuid:data.uuid,
                        fileName:uploadAWDetail.fileName.value,
                        fileTypeId:uploadAWDetail.fileTypeId.value
                    }
                })

                var upload = layui.upload,
                    element = layui.element;
                element.init();

                file = upload.render({
                    elem: '#awchoosefile'
                    ,url: http + "/api/resultFile/uploadFile"
                    ,accept: 'file' //允许上传的文件类型
                    ,auto: false
                    ,method:'post'
                    ,bindAction: '#awupload'
                    ,done: function(res){
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                        console.log(res)  //返回对象数据
                    }
                })
            }
        });
    });

    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        $.ajax({
            type:"post",
            url:http+"/api/dc/AwardUpload",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:{
                PROJECT_ID:addAWDetail.PROJECT_ID.value,
                AWARD_NAME:addAWDetail.AWARD_NAME.value,
                AWARD_UNIT:addAWDetail.AWARD_UNIT.value,
                AWARD_TIME:addAWDetail.AWARD_TIME.value,
                RANKING:addAWDetail.RANKING.value,
                TYPE_ID:addAWDetail.TYPE_ID.value,
                NAME:addAWDetail.NAME.value,
                GENDER:addAWDetail.GENDER.value,
                PROFESSIONAL_TITLE:addAWDetail.PROFESSIONAL_TITLE.value,
                UNIT:addAWDetail.UNIT.value,
                RESULT_TYPE_ID:addAWDetail.RESULT_TYPE_ID.value,
                WRITER_TYPE_ID:addAWDetail.WRITER_TYPE_ID.value
            },
            success: function (data) {
                layer.msg('添加成功');
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>

<!--软件-->
<script>
    var addlay,uploadlay,filelay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#ATable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'softwareName', title: '名称', align: 'center'},
                    {field: 'writers', title: '作者', align: 'center'},
                    {field: 'publishTime', title: '时间', sort: true, align: 'center'},
                    {field: 'webSite', title: '网址', align: 'center'},
                    {fixed: 'right', title: '文件', templet: '#file', align: 'center'},
                    {fixed: 'right', title: '操作', templet: '#handle', align: 'center'}
                ]],
                toolbar: '#myAToolbar',
            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/software/find',function (result) {
                /*console.log(result.data[0].writers)*/
                for(var i=0;i<result.data.length;i++){
                    result.data[i].webSite = "<a href=`result.data[i].webSite`>" + result.data[i].webSite + "</a>"
                 /*   console.log(result.data[i].webSite)*/
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writers.length;j++){
                        authorinfo += result.data[i].writers[j].name + ":" + result.data[i].writers[j].gender +","+ result.data[i].writers[j].unit +","+ result.data[i].writers[j].typeName +","+ result.data[i].writers[j].professionalTitle +","+ result.data[i].writers[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writers = authorinfo
                }
                loadData(result.data);
            });
        }
        loadTable()

        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addAContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(ATable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加软件信息',
                        area: ['70%', '70%'],
                        content: $('#addAContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                       layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                            $.get(http+'/api/software/delete', {"uuid": dids}, function () {
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                    loadTable()
                                });
                            });
                            layer.close(index);
                        });
                    }
                    break;
            }
        });
        //单个删除/下载
        table.on('tool(ATable)', function(obj) {
            var data = obj.data;
            console.log(data.uuid)
            if(obj.event === 'filework'){
                filelay = layer.open({
                    type: 1,
                    title: '相关文件',
                    area: ['40%', '60%'],
                    content: $('#fileAContainer'),
                });
                console.log(data.uuid)
                $.get(http+"/api/resultFile/findFiles",{resultId:data.uuid},function(result) {
                    console.log(result)
                    var str = ''
                    console.log(result.data.length)
                    for (var i=0;i<result.data.length;i++){
                        str += '<tr>';
                        var tds =  '<td>' + result.data[i].fileName + '</td>'
                            + '<td>' + result.data[i].fileType + '</td>';
                            /*+ '<td><button data-method="notice" onclick="uploadFile(`uploadAContainer`+,+`uploadADetail`+,+`aupload`+,+`achoosefile`+,+`'+result.data[i].fileId+'`);layer.close(filelay)" class="layui-btn " ><i class="layui-icon layui-icon-upload-circle"></i>上传</button>' +
                            '<button data-method="notice" onclick="downloadDir(`\'+result.data.dirs[i].dirId+\'`)" class="layui-btn layui-btn-normal layui-btn-mini download" ><i class="layui-icon layui-icon-download-circle"></i>下载</button>' +
                            '<button data-method="notice" onclick="downloadDir(`\'+result.data.dirs[i].dirId+\'`)" class=" layui-btn layui-btn-danger layui-btn-mini delete" ><i class="layui-icon layui-icon-delete"></i>删除</button>' +
                            '</td>'*/
                        str += tds ;
                        str += '</tr>';
                    }
                    $("#myAbody").html(str)
                });
            }
            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    /*obj.del();*/
                    $.get(http+'/api/software/delete', {uuid: data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }
            if (obj.event === 'upload') {
                uploadlay = layer.open({
                    type: 1,
                    title: '上传软件文件',
                    area: ['40%', '40%'],
                    content: $('#uploadAContainer'),
                    end: function () {
                    }
                });
                //文件上传
                $("#aupload").on('click',function () {
                    file.config.data = {
                        uuid:data.uuid,
                        fileName:uploadRDetail.fileName.value,
                        fileTypeId:uploadRDetail.fileTypeId.value
                    }
                })

                var upload = layui.upload,
                    element = layui.element;
                element.init();

                file = upload.render({
                    elem: '#achoosefile'
                    ,url: http + "/api/resultFile/uploadFile"
                    ,accept: 'file' //允许上传的文件类型
                    ,auto: false
                    ,bindAction: '#aupload'
                    ,done: function(res){
                        layui.use('layer', function(){
                            console.log(res.code)
                            if(res.code==0){
                                var layer = layui.layer;
                                return layer.msg("上传失败！")
                            }else{
                                var layer = layui.layer;
                                layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                                setTimeout(function(){
                                    //刷新
                                    location.reload();
                                },1000);
                            }
                        });
                        console.log(res)  //返回对象数据
                    }
                })
            }
            if(obj.event === 'download'){
                layer.confirm('请选择下载文件！', {
                    title: "Tips" ,btnAlign: 'c',
                    btn: ['设计文档下载', '相关文件下载','取消']
                    ,btn3: function(index, layero){
                        layer.close()
                    }
                }, function(index, layero){
                    $.get(http+'/api/software/downLoadFile', {fileId: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                }, function(index){
                    //按钮二的回调
                    $.get(http+'/api/software/downLoadFile', {fileId: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                });
            }
        });
    });

    //添加作者信息
    function addInfo() {
        var winfo = []
        winfo =  $("#awid").find("option:selected").text() + ":" +  $("#aorder").find("option:selected").text()
        $("#awinfo").append(winfo+",")
    }
    //添加码信息
    function addCode() {
        var dinfo = []
        dinfo =  $("#awid").find("option:selected").val() + "," +  $("#aorder").find("option:selected").val() + ","
        $("#detailInfo").append(dinfo)
    }

    //转格式
    $.fn.serializeObject = function()
    {
        var res = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (res[this.name] !== undefined) {
                if (!res[this.name].push) {
                    res[this.name] = [res[this.name]];
                }
                res[this.name].push(this.value || '');
            } else {
                res[this.name] = this.value || '';
            }
        });
        return res;
    };
    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        function form2JsonString(formId) {
            var paramArray = $('#' + formId).serializeArray();
            var jsonObj = {};
            $(paramArray).each(function () {
                jsonObj[this.name] = this.value;
            });
            return JSON.stringify(jsonObj);
        }
        swjsondata  = eval("("+form2JsonString("addADetail")+")");
        console.log(swjsondata)
        var writer = swjsondata.detailInfo.split(",")
        console.log(writer)
        var writerInfo = [];

        for(var i=0;i<(writer.length-1)/2;i++){
           var order ={
               "resultTypeId": swjsondata.resultTypeId,
               "wid": writer[2*i],
               "writerTypeId": writer[2*i+1]
           }
           console.log(order)
           writerInfo.push(order)
        }
    console.log(writerInfo)
        var a = {
                "projectId": swjsondata.projectId,
                "publishTime": swjsondata.publishTime,
                "softwareName": swjsondata.softwareName,
                "webSite": swjsondata.webSite,
                writerInfo
            };

        $.ajax({
            type:"post",
            url:http+"/api/software/insert",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:JSON.stringify(a),
            success: function (data) {
                layer.msg('添加成功');
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>

<!--报告-->
<script>
    var addlay,uploadlay,filelay;
    var getbid = location.search;
    var bybid = "";
    if(getbid){
        var cout = 0;
        for(var i=0;i<getbid.length;i++){
            if(cout!=0){
                bybid+=getbid.charAt(i);
            }
            if(getbid.charAt(i)==="="){
                cout = i;
            }
        }
    }
    layui.use('table', function() {
        var table = layui.table
            , form = layui.form;
        var $ = layui.$;

        function loadData(data) {//渲染表
            table.render({
                elem: '#RTable',
                data: data,
                cols: [[
                    {type: 'checkbox'},
                    {field: 'reportName', title: '名称', align: 'center'},
                    {field: 'writerInfos', title: '撰写人', align: 'center'},
                    {field: 'writeTime', title: '撰写时间', align: 'center'},
                    {fixed: 'right', title: '文件', templet: '#file', align: 'center'},
                    {fixed: 'right', title: '操作', templet: '#handle', align: 'center'}
                ]],
                page: true,
                toolbar: '#myRToolbar',

            })
        }

        //加载表数据
        function loadTable(){
            $.get(http+'/api/resultReport/find',function (result) {
                console.log(result.data.length)
                for(var i=0;i<result.data.length;i++){
                    var authorinfo = ''
                    for(var j=0;j<result.data[i].writerInfos.length;j++){
                        authorinfo += result.data[i].writerInfos[j].writerName + ":" + result.data[i].writerInfos[j].gender +","+ result.data[i].writerInfos[j].typeName +","+ result.data[i].writerInfos[j].professionalTitle +","+ result.data[i].writerInfos[j].writerType+"。"+ " <br>"
                    }
                    result.data[i].writerInfos = authorinfo
/*                    console.log(result.data[i].writerInfos)*/
                }
                loadData(result.data);
            });
        }
        loadTable()


        //重载
        $('#find').click(function () {
            var did = $('#search').val();
            if (did.length != 0) {
                $.post(http+'/api/DetailType/findById', {"did": did}, function (data) {
                    if(data.data==null){
                        layer.msg('没有找到该详细类型')
                    }
                    else{
                        var myData = [];
                        myData.push(data.data);
                        loadData(myData);
                    }
                })
            } else {
                loadTable();
            }
        });
        //回车重载
        $('#search').on('keypress',function (event) {
            if(event.keyCode==13){
                $('#find').click();
            }
        });
        //回车添加
        $('#addRContainer').on('keypress',function (event) {
            if(event.keyCode==13){
                addDetail();
            }
        });

        //监听头工具栏事件（添加、批量删除）
        table.on('toolbar(RTable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            switch(obj.event){
                case 'add':
                    addlay = layer.open({
                        type: 1,
                        title: '添加报告',
                        area: ['50%', '70%'],
                        content: $('#addRContainer'),
                        end: function () {
                            loadTable();
                        }
                    });
                    break;
                case 'delete':
                    if(data.length === 0){
                        layer.msg('请选择一行');
                    } else {
                        //删除
                        var dids = "";
                        for(var i=0;i<data.length;i++){
                            if(i!=data.length-1){
                                dids+=data[i].uuid+",";
                            }
                            else{
                                dids+=data[i].uuid
                            }
                        }
                        layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                            $.get(http+'/api/resultReport/delete', {"uuid": dids}, function () {
                                layui.use('layer', function(){
                                    var layer = layui.layer;
                                    layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                                    loadTable()
                                });
                            });
                            layer.close(index);
                        });
                    }
                    break;
            }
        });
        //单个删除/下载/上传
        table.on('tool(RTable)', function(obj) {
            var data = obj.data;
            console.log(data)
            if(obj.event === 'filework'){
                filelay = layer.open({
                    type: 1,
                    title: '相关文件',
                    area: ['40%', '60%'],
                    content: $('#fileRContainer'),
                });
                console.log(data.uuid)
                $.get(http+"/api/resultFile/findFiles",{resultId:data.uuid},function(result) {
                    console.log(result)
                    var str = ''
                    console.log(result.data.length)
                    for (var i=0;i<result.data.length;i++){
                        str += '<tr>';
                        var tds =  '<td>' + result.data[i].fileName + '</td>'
                            + '<td>' + result.data[i].fileType + '</td>';
                        str += tds ;
                        str += '</tr>';
                    }
                    $("#myRbody").html(str)
                });
            }
            if (obj.event === 'del') {
                layer.confirm('确认删除吗？', {title: '删除'}, function (index) {
                    obj.del();
                    $.get(http+'/api/resultReport/delete', {uuid: data.uuid}, function () {
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '删除成功! '  + "</h3>",{title:"温馨提示"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                    });
                    layer.close(index);
                });
            }

            if (obj.event === 'upload') {
                uploadlay = layer.open({
                    type: 1,
                    title: '上传报告文件',
                    area: ['40%', '40%'],
                    content: $('#uploadRContainer'),
                    end: function () {
                    }
                });
                //文件上传
                $("#rupload").on('click',function () {
                    file.config.data = {
                        uuid:data.uuid,
                        fileName:uploadRDetail.fileName.value,
                        fileTypeId:uploadRDetail.fileTypeId.value
                    }
                })

                var upload = layui.upload,
                    element = layui.element;
                element.init();

                file = upload.render({
                    elem: '#rchoosefile'
                    ,url: http + "/api/resultFile/uploadFile"
                    ,accept: 'file' //允许上传的文件类型
                    ,auto: false
                    //,multiple: true
                    ,bindAction: '#rupload'
                    ,done: function(res){
                        layui.use('layer', function(){
                            var layer = layui.layer;
                            layer.alert("<h2 style='color:black'>" + '上传成功！' + "</h2>",{title: "Tips"});
                            setTimeout(function(){
                                //刷新
                                location.reload();
                            },1000);
                        });
                        console.log(res)  //返回对象数据
                    }
                })
            }
            if(obj.event === 'download'){
                layer.confirm('请选择下载文件！', {
                    title: "Tips" ,btnAlign: 'c',
                    btn: ['设计文档下载', '相关文件下载','取消']
                    ,btn3: function(index, layero){
                        layer.close()
                    }
                }, function(index, layero){
                    $.get(http+'/api/resultFile/downLoadFile', {fileId: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                }, function(index){
                    //按钮二的回调
                    $.get(http+'/api/resultFile/downLoadFile', {uuid: data.uuid}, function (result) {
                        if(result.status =="success"){
                            var layer = layui.layer;
                            layer.alert("<h3 style='color:black'>" + '已开始下载! '  + "</h3>",{title:"温馨提示"});
                        }
                    })
                });
            }
        });
    });

    //添加作者信息
    function addRInfo() {
        var winfo = []
        winfo =  $("#rwid").find("option:selected").text() + ":" +  $("#rorder").find("option:selected").text()
        $("#rwinfo").append(winfo+",")
    }
    //添加码信息
    function addRCode() {
        var dinfo = []
        dinfo =  $("#rwid").find("option:selected").val() + "," +  $("#rorder").find("option:selected").val() + ","
        $("#rdetailInfo").append(dinfo)
    }

    //转格式
    $.fn.serializeObject = function()
    {
        var res = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (res[this.name] !== undefined) {
                if (!res[this.name].push) {
                    res[this.name] = [res[this.name]];
                }
                res[this.name].push(this.value || '');
            } else {
                res[this.name] = this.value || '';
            }
        });
        return res;
    };
    //提交添加表单
    function addDetail() {
        var $ = layui.$;
        function form2JsonString(formId) {
            var paramArray = $('#' + formId).serializeArray();
            var jsonObj = {};
            $(paramArray).each(function () {
                jsonObj[this.name] = this.value;
            });
            return JSON.stringify(jsonObj);
        }
        swjsondata  = eval("("+form2JsonString("addRDetail")+")");
        console.log(swjsondata)
        console.log(swjsondata.detailInfo)
        var writer = swjsondata.rdetailInfo.split(",")
        console.log(writer)
        var writers = [];
        for(var i=0;i<(writer.length-1)/2;i++){
            var order ={
                "resultTypeId": swjsondata.resultTypeId,
                "writerId": writer[2*i],
                "writerTypeId": writer[2*i+1]
            }
            console.log(order)
            writers.push(order)
        }
        console.log(writers)

        var a = {
            "projectId": swjsondata.projectId,
            "writeTime": swjsondata.writeTime,
            "projectResultName": swjsondata.projectResultName,
            writers: writers
        };
        console.log(a)
        $.ajax({
            type:"post",
            url:http+"/api/resultReport/insert",
            dataType:"json",
            contentType : "application/json;charset=UTF-8",
            traditional:true,
            data:JSON.stringify(a),
            success: function (data) {
                layer.msg('添加成功');
                layer.close(addlay);
            },
            error: function (data) {
                layer.msg('错误码：'+data.status);
                layer.close(addlay);
            }
        });
    }

</script>


</body>
</html>